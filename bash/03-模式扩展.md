# 模式扩展

## 简介

- shell 接受用户输入的命令以后，会根据空格将用户的输入拆分成一个个token,然后shell会扩展token里的特殊字符，扩展完成后才会调用相应的命令。这种特殊字符的扩展称为模式扩展（globbing）。其中有些用到通配符又称通配符扩展（wildcard expansion）。bash一共提供八种扩展。模式扩展与正则表达式的关系是，模式扩展早于正则表达式出现，可以看作是原始的正则表达式。它的功能没有正则那么强大灵活，但是优点是简单和方便。
  - `波浪线扩展`
  - `? 字符扩展`
  - `* 字符扩展`
  - `方括号扩展`
  - `大括号扩展`
  - `变量扩展`
  - `子命令扩展`
  - `算术扩展`
- `set -o noglob` 或 `set -f`: 关闭扩展
- `set +o noglob` 或 `set +f`: 打开扩展

## 波浪线扩展

- `~`会自动扩展成当前用户的主目录
  - `echo ~`
- `cd ~/foo`: 进入主目录下的foo文件夹
- `echo ~foo`: foo用户存在则扩展成用户foo的主目录: `/home/foo`不存在则不起作用`~foo`
- `~+`: 等同于`pwd`

## ?字符扩展

- `?`: 代表文件路径里的任意单个字符，不包括空字符
  - `ls ?.txt`
  - `ls ??.txt`
- `?`属于文件名扩展，只有文件确实存在的前提下才会发生扩展。如果文件不存在，扩展就不会发生
  - `echo ?.text`: 当前目录有 a.txt 则输出`a.txt`空目录则输出`?.txt`

## *字符扩展

- `*`: 代表文件路径里的任意数量的字符，保留零个字符
- `ls *`: 输出当前目录的所有文件（是文件不是文件夹）。同时`ls *`不会匹配隐藏文件，如果要匹配隐藏文件需要写成`ls .*`
- `echo .[!.]*` 或 `echo .[^.]*`: 可以排除`.`和`..`这来个特殊的隐藏文件
- `ls */*.txt`: 匹配一层子目录下的
- `ls **/*.txt`: 匹配顶层文本文件和任意深度子目录的文本文件

## 方括号扩展

- `ls [ab].txt`: 匹配a.txt、b.txt
- `ls [^ab].txt`或`ls [!ab].txt`: 排除a.txt、b.txt
- 如果要匹配`[`可以这么写`[[]`如果要匹配连字符`-`只能放到方括号的开头或结尾`[-abc]`或`[abc-]`
- `[a-Z]`: 表示一个连续的范围

## 大括号扩展

- 表示分别扩展成大括号里的所有制，值与值之间用逗号分隔
  - `echo {1,2,3}`
- 注意，大括号扩展不是文件名扩展。它会扩展所有给定的值而不管是否有对应的文件存在
- 大括号内部的逗号钱不能有空格否则扩展会失效。因为bach会认为这是独立的参数而不是大括号扩展了
- 逗号前可以没有值，表示第一项为空
  - `echo a.log{,.bak}`: `a.log a.log.bak`
- `echo {j{p,pe}g,png}`: 大括号嵌套
- 大括号可以与其他模式联用，总是先于其他模式
- `echo {a..z}`: 扩展成26个小写的英文字母`echo {z..a}`
- `mkdir {2007..2009}-{01..12}`: 新建36个子目录
- `echo {01..5}`: 如果整数前面有前导0，扩展输出的每一项都有前导0
- `echo {0..8..2}`: 这种简写形式还可以使用第二个双点号（start..end..step），用来指定扩展的步长

## 变量扩展

- 详见《bash 变量》
- `echo $SHELL`：`/bin/bash`
- `echo ${SHELL}`: `/bin/bash`
- `echo ${!S*}`: `${!S*}`扩展成所有以S开头的变量名。

## 子命令扩展

- 可以扩展成另一个命令的运行结果，该命令的所有输出都会作为返回值。
- `echo $(date)`: Mon Oct 30 16:33:49 CST 2023(注意命令里不是花括号)
- `$(ls $(pwd))`

## 算术扩展

- 详见《bash 的算术运算》
- `echo $((2 + 2))`

## 字符类

- 字符类也属于文件名扩展，如果没有匹配的文件名，字符类就会原样输出。常用的字符类如下。
  - [[:alnum:]]：匹配任意英文字母与数字
  - [[:alpha:]]：匹配任意英文字母
  - [[:blank:]]：空格和 Tab 键。
  - [[:cntrl:]]：ASCII 码 0-31 的不可打印字符。
  - [[:digit:]]：匹配任意数字 0-9。
  - [[:graph:]]：A-Z、a-z、0-9 和标点符号。
  - [[:lower:]]：匹配任意小写字母 a-z。
  - [[:print:]]：ASCII 码 32-127 的可打印字符。
  - [[:punct:]]：标点符号（除了 A-Z、a-z、0-9 的可打印字符）。
  - [[:space:]]：空格、Tab、LF（10）、VT（11）、FF（12）、CR（13）。
  - [[:upper:]]：匹配任意大写字母 A-Z。
  - [[:xdigit:]]：16进制字符（A-F、a-f、0-9）

## 量词语法

## shopt 命令

- 用于显示和设置shell中的行为选项，通过这些选项以增强shell易用性。shopt命令若不带任何参数选项，则可以显示所有可以设置的shell操作选项。
- `shopt -s [optionname]`: 打开某个参数
- `shopt -u [optionname]`: 关闭某个参数
- `shopt [optionname]`: 查看某个参数的状态

- 具体见网页文档吧

- `globstar`参数可以使得**匹配零个或多个子目录。该参数默认是关闭的。
