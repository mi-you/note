# bash 变量

- 分为环境变量和自定义变量

## 环境变量

- `env` 或 `printenv`: 显示所有的环境变量
- `printenv PATH` 或 `echo $PATH`：查看单个环境变量的值，注意`printenv`后面的变量名前没有`$`
- `set`: 显示所有变量（自定义变量和环境变量）以及所有的bash 函数

## 创建变量

- `myvar=1`
- `myvar="hello world"`
- `myvar=$(( 3 * 4))`

## 读取变量

- `$myvar`
- `myvar=USER;echo ${!myvar}`: 如果变量的值也是变量，可以使用`${!varname}`的语法，读取最终的值

## 删除变量

- `unset NAME`: 这个命令不是很有用。因为不存在的 Bash 变量一律等于空字符串，所以即使unset命令删除了变量，还是可以读取这个变量，值为空字符串
- `foo=''` 或 `foo=`: 也是删除一个变量

## 输出变量，export命令

- 用户创建的变量仅可用于当前 Shell，子 Shell 默认读取不到父 Shell 定义的变量。为了把变量传递给子 Shell，需要使用export命令。这样输出的变量，对于子 Shell 来说就是环境变量。
- `export NAME=value`

## 特殊变量

- bash 提供一些特殊变量，这些变量值由shell提供，用户不能进行赋值
- `$?`: 为上一个命令的退出码，用来判断上一个命令是否执行成功。返回值是0，表示上一个命令执行成功；如果不是零，表示上一个命令执行失败
- `$$`: 为当前 Shell 的进程 ID。
- `$_`: 为上一个命令的最后一个参数。
- `$!`: 为最近一个后台执行的异步命令的进程 ID。
- `$0`: 为当前 Shell 的名称（在命令行直接执行时）或者脚本名（在脚本中执行时）
- `$-`: 为当前 Shell 的启动参数。
- `$#`: 表示脚本的参数数量，
- `$@`: 表示脚本的参数值，参见脚本一章。

## 变量的默认值

- `${varname:-word}`: 变量varname存在且不为空，则返回它的值，否则返回word
- `${varname:=word}`: 变量varname存在且不为空，则返回它的值，否则将它设为word，并且返回word
- `${varname:+word}`: 变量名存在且不为空，则返回word，否则返回空值。它的目的是测试变量是否存在
- `${varname:?message}`: 变量varname存在且不为空，则返回它的值，否则打印出varname: message
- `filename=${1:?"filename missing"}`: 上面四种语法如果用在脚本中，变量名的部分可以用数字1到9，表示脚本的参数

## declare 命令

- declare命令的主要参数（OPTION）如下。
  - `-a`：声明数组变量。
  - `-f`：输出所有函数定义。
  - `-F`：输出所有函数名。
  - `-i`：声明整数变量。
  - `-l`：声明变量为小写字母。
  - `-p`：查看变量信息。
  - `-r`：声明只读变量。
  - `-u`：声明变量为大写字母。
  - `-x`：该变量输出为环境变量。

## readonly 命令

- `readonly`等同于`declare -r`
- readonly命令有三个参数。
  - `-f`：声明的变量为函数名。
  - `-p`：打印出所有的只读变量。
  - `-a`：声明的变量为数组。

## let 命令

- `let foo=1+2`: 可直接执行算术表达式
- `let "foo = 1 + 2"`: let命令的参数表达式如果包含空格，就需要使用引号。
- `let 'v1=1' 'v2 =v1++`: let可以同时对多个变量赋值，赋值表达式之间使用空格分隔。
